# 2. Automated Takeoff Release Notes

This Repo is used to automatically generate release notes from several fields in Jira, and publish them to our [Zendesk Release Notes page](https://support.takeoff.com/hc/en-us/articles/4417757892753).

This project was originally tracked by [PROD-2610](https://takeofftech.atlassian.net/browse/PROD-2610) and [PROD-3496](https://takeofftech.atlassian.net/browse/PROD-3496).

## Overview

This release notes auotmation is meant to support a single-page, date-driven set of  Along with that, Takeoff's Engineering team began transitioning to a ci/cd microservices-based method of creating and deploying our software.

To accomodate those changes, we stopped generating client-specific Release Notes, and introduced a single-page model in Zendesk that is more common to Cloud SaaS companies. The common example we use for this is: https://cloud.google.com/release-notes.

The details of this change are documented more extensively in Confluence [here](https://takeofftech.atlassian.net/wiki/spaces/TE/pages/3714285645/Release+Notes+Automation+Rollout) and [here](https://takeofftech.atlassian.net/wiki/spaces/TOP/blog/2022/11/08/3846668647/Release+Communications+Best+Practices+How+and+When+to+Communicate+about+Releases), and our [Engineering Handbook](https://engineering-handbook.takeofftech.org/docs/domains/production/release-notes/).

There is a one-business-day SLA for reviewing and publishing of new or updated release notes.

## Basic overview of the automation

1. [ZD_html_to_dict.yml](https://github.com/takeoff-com/release-notes/blob/master/.github/workflows/ZD_html_to_dict.yml) runs at 6 AM, 12 PM, and 6 PM (UTC) 7 days of the week.

That workflow performs several steps:

   1. It retrieves the contents of the Zendesk page and adds it to data/zendesk_data.html (for use in step 3).

   2. It then queries Jira for anything with **Release Notes Required** field value = **Yes - Ready to Publish** and adds the contents of the following fields to data/jira_data_temp.json:

      - **Release Notes Description**

      - **Fix Versions**

      - **Product Area**

1. Once the above data is retrieved, we use several scripts to compare the data from Jira and Zendesk, add or update data accordingly, and then format and output that data to `release_notes_zendesk.html`. The scripts used are:

  

   - `jira_issue.py` - Creates a list of jira entities from Jira data that can be used in `union_data.py`.

     - The data is sorted by date and grouped product area.

     - Fix Versions are parsed and the earliest one is used if there are multiple. The value is formatted as "RTww-yy" (date information is stripped), and non "RT" fix verisons are ignored.

   - `union_data.py` - Unites data from zendesk and jira, sorts it, groups by Date and issueType, and then returns that unified data.

   - `html_to_dict.py` - Creates a dictionary of jira items from html data.

   - `release_notes_builder.py` uses outputs from `html_to_dict` and `union_data.py` to generate the final release notes html file according to the format defined in the `template.html` file.

4. At that point, a Pull Request is created so that a member of @team-chamaeleon can review the updated data according to the [Release Communications Best Practices](https://takeofftech.atlassian.net/wiki/spaces/TOP/blog/2022/11/08/3846668647/Release+Communications+Best+Practices+How+and+When+to+Communicate+about+Releases)

5. When the PR is approved and merged, [send_to_zd.yml](https://github.com/takeoff-com/release-notes/blob/master/.github/workflows/send_to_zd.yml) is triggered, which uses `html_to_json.py` to transform the contents of `release_notes_zendesk.html` to json, and send it to zendesk to overwrite the previous data in the article with the latest.

  
  

## Repo How-Tos

### Review and Publish Release Notes

1. When Jira issues issues are marked as "Yes - Ready to Published," the automation will pick up the contents of the Release Notes Description field, add them to the release notes with a date stamp, and generate a PR.

2. When the PR is created, a slack message is auto-generated in the [# Domain Technical Documentation](https://takeofftech.slack.com/archives/C01HD8K8QEP) slack channel.

3. The content of the changed file in the pull request must then be reviewed for language, client-identifiable info, etc. See [Release Notes Automation Launch](https://takeofftech.atlassian.net/wiki/spaces/TE/pages/3714285645/Release+Notes+Automation+Launch) for more detail.

4. If everything looks good, the PR can be approved and merged to Master. That kicks off a final workflow that publishes the content to Zendesk.

  

#### Manually kick off a release notes run

1. "Full Workflow" [ZD_html_to_dict.yml](https://github.com/takeoff-com/release-notes/blob/master/.github/workflows/ZD_html_to_dict.yml) can be run via Workflow dispatch

2. Once the PR generated by that workflow is approved and merged, the rest of the publishing process takes place automatically via [send_to_zd.yml](https://github.com/takeoff-com/release-notes/blob/master/.github/workflows/send_to_zd.yml).

#### Modify a previously published issue

You can *update the description*, *change the date*, or *change order/location* a previously published issue.

  

**To update the description (or Product area, Fix Versions, ):**

1. Open the related Jira ticket and update the **Release Note Description** field.

2. The next time the automation runs that day, the updated description will replace the existing one. The issue will stay with the same location and date.

If the change must be made urgently, please reach out to @team-chamaeleon with the Jira number and desired date.

  

**Change the location in the Zendesk article, or date:**

1. In this repo, create a new branch and modify the html file in data > [release_notes_zendesk.html](https://github.com/takeoff-com/release-notes/blob/master/data/release_notes_zendesk.html) according to the requested changes.

2. Open Zendesk and also modify the [Release Notes article](https://takeoffhelp.zendesk.com/hc/en-us/articles/4417757892753-Takeoff-Release-Notes) accoridngly. Be sure to use the "HTML" view to preserve any tag structure.

3. Merge to Master and a workflow will be kicked off that publishes the modified content to Zendesk. The change will be preserved after that.

#### Delete a previously published issue

1. In this repo, create a new branch and delete the issue and corresponding date (if its the only issue under that date) in the html file in data > [release_notes_zendesk.html](https://github.com/takeoff-com/release-notes/blob/master/data/release_notes_zendesk.html) according to the requested changes.

2. Open Zendesk and also modify the [Release Notes article](https://takeoffhelp.zendesk.com/hc/en-us/articles/4417757892753-Takeoff-Release-Notes) accoridngly. Be sure to preserve any div tags in the html view.

3. Merge to Master and a workflow will be kicked off that publishes the modified content to Zendesk. The change will be preserved after that point.